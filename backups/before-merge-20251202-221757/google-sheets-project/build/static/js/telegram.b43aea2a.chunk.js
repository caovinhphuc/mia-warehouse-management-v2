"use strict";(self.webpackChunkreact_google_sheets_project=self.webpackChunkreact_google_sheets_project||[]).push([[410],{23733:(e,s,t)=>{t.r(s),t.d(s,{default:()=>o});var a=t(65043),n=t(5137),i=t(58021);const c=import.meta.env.VITE_API_URL||import.meta.env.REACT_APP_API_URL||"http://localhost:3001";const r=new class{async sendMessage(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"HTML";try{const a=await fetch("".concat(c,"/api/alerts/telegram"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,chatId:s||import.meta.env.VITE_TELEGRAM_CHAT_ID||import.meta.env.REACT_APP_TELEGRAM_CHAT_ID,parseMode:t,disableNotification:!1})});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.error||"Telegram send failed: ".concat(a.statusText))}return await a.json()}catch(a){throw console.error("Error sending Telegram message:",a),a}}async sendSimpleMessage(e){return this.sendMessage(e)}async sendHTMLMessage(e){return this.sendMessage(e,null,"HTML")}async sendMarkdownMessage(e){return this.sendMessage(e,null,"Markdown")}async testConnection(){try{const e=await fetch("".concat(c,"/api/alerts/test"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({channel:"telegram"})});if(!e.ok)throw new Error("Test failed: ".concat(e.statusText));return await e.json()}catch(e){throw console.error("Error testing Telegram connection:",e),e}}};var l=t(68508),d=t(70579);const o=()=>{const{loading:e,error:s}=(0,n.d4)(e=>e.auth),{isAuthenticated:t,serviceAccount:c}=(0,n.d4)(e=>e.auth),[o,h]=(0,a.useState)(null),[m,g]=(0,a.useState)([]),[x,u]=(0,a.useState)(null),[j,v]=(0,a.useState)([]),[p,b]=(0,a.useState)(""),[N,_]=(0,a.useState)("text"),[y,f]=(0,a.useState)(!1),[T,w]=(0,a.useState)(""),[k,C]=(0,a.useState)(!1),S={id:"8434038911",username:"mia_logistics_bot",first_name:"MIA Logistics Bot",can_join_groups:!0,can_read_all_group_messages:!1,supports_inline_queries:!1},M=[{id:"-4818209867",type:"group",title:"MIA Logistics Team",username:"mia_logistics_team",member_count:15,last_activity:"2024-01-15T10:30:00Z"},{id:"123456789",type:"private",first_name:"Nguy\u1ec5n V\u0103n A",username:"nguyenvana",last_activity:"2024-01-14T15:45:00Z"},{id:"987654321",type:"private",first_name:"Tr\u1ea7n Th\u1ecb B",username:"tranthib",last_activity:"2024-01-13T09:20:00Z"}],A=[{id:1,chat_id:"-4818209867",text:"B\xe1o c\xe1o h\xe0ng ng\xe0y \u0111\xe3 \u0111\u01b0\u1ee3c t\u1ea1o th\xe0nh c\xf4ng!",date:"2024-01-15T10:30:00Z",from:"bot",message_type:"text"},{id:2,chat_id:"-4818209867",text:"C\xf3 5 \u0111\u01a1n h\xe0ng m\u1edbi c\u1ea7n x\u1eed l\xfd",date:"2024-01-15T09:15:00Z",from:"bot",message_type:"text"},{id:3,chat_id:"-4818209867",text:"H\u1ec7 th\u1ed1ng backup \u0111\xe3 ho\xe0n th\xe0nh",date:"2024-01-15T08:00:00Z",from:"bot",message_type:"text"}];(0,a.useEffect)(()=>{h(S),g(M),v(A),f(!0)},[]);const L=e=>new Date(e).toLocaleDateString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),D=e=>"group"===e.type?e.title:"".concat(e.first_name," ").concat(e.last_name||"").trim(),E=e=>"group"===e.type?"\ud83d\udc65":"\ud83d\udc64";return e?(0,d.jsx)(i.A,{}):s?(0,d.jsxs)("div",{className:"error-state",children:["L\u1ed7i: ",s]}):(0,d.jsxs)("div",{className:"telegram-container",children:[(0,d.jsxs)("div",{className:"telegram-header",children:[(0,d.jsxs)("div",{className:"header-left",children:[(0,d.jsx)("h1",{children:"\ud83d\udcac Telegram Bot"}),(0,d.jsx)("p",{children:"Qu\u1ea3n l\xfd v\xe0 g\u1eedi th\xf4ng b\xe1o qua Telegram"})]}),(0,d.jsx)("div",{className:"header-right",children:(0,d.jsxs)("div",{className:"connection-status",children:[(0,d.jsx)("div",{className:"status-dot ".concat(y?"connected":"disconnected")}),(0,d.jsx)("span",{children:y?"\u0110\xe3 k\u1ebft n\u1ed1i":"Ch\u01b0a k\u1ebft n\u1ed1i"})]})})]}),(0,d.jsxs)("div",{className:"telegram-content",children:[(0,d.jsxs)("div",{className:"bot-info-card",children:[(0,d.jsx)("div",{className:"card-header",children:(0,d.jsx)("h3",{children:"\ud83e\udd16 Th\xf4ng tin Bot"})}),(0,d.jsx)("div",{className:"card-body",children:o&&(0,d.jsxs)("div",{className:"bot-details",children:[(0,d.jsx)("div",{className:"bot-avatar",children:"\ud83e\udd16"}),(0,d.jsxs)("div",{className:"bot-info",children:[(0,d.jsx)("div",{className:"bot-name",children:o.first_name}),(0,d.jsxs)("div",{className:"bot-username",children:["@",o.username]}),(0,d.jsxs)("div",{className:"bot-id",children:["ID: ",o.id]})]})]})})]}),(0,d.jsxs)("div",{className:"webhook-card",children:[(0,d.jsx)("div",{className:"card-header",children:(0,d.jsx)("h3",{children:"\ud83d\udd17 C\xe0i \u0111\u1eb7t Webhook"})}),(0,d.jsx)("div",{className:"card-body",children:(0,d.jsxs)("div",{className:"webhook-form",children:[(0,d.jsx)("input",{type:"url",placeholder:"Nh\u1eadp URL webhook...",value:T,onChange:e=>w(e.target.value),className:"webhook-input"}),(0,d.jsxs)("div",{className:"webhook-actions",children:[(0,d.jsx)("button",{className:"btn btn-primary",onClick:()=>{T.trim()&&(console.log("Setting webhook to:",T),alert("Webhook \u0111\xe3 \u0111\u01b0\u1ee3c thi\u1ebft l\u1eadp th\xe0nh c\xf4ng!"))},disabled:!T.trim(),children:"Thi\u1ebft l\u1eadp Webhook"}),(0,d.jsx)("button",{className:"btn btn-danger",onClick:()=>{w(""),console.log("Webhook deleted"),alert("Webhook \u0111\xe3 \u0111\u01b0\u1ee3c x\xf3a!")},disabled:!T.trim(),children:"X\xf3a Webhook"})]})]})})]}),(0,d.jsxs)("div",{className:"chats-messages-container",children:[(0,d.jsxs)("div",{className:"chats-sidebar",children:[(0,d.jsxs)("div",{className:"sidebar-header",children:[(0,d.jsx)("h3",{children:"\ud83d\udcac Danh s\xe1ch Chat"}),(0,d.jsxs)("span",{className:"chat-count",children:[m.length," chats"]})]}),(0,d.jsx)("div",{className:"chats-list",children:m.map(e=>(0,d.jsxs)("div",{className:"chat-item ".concat((null===x||void 0===x?void 0:x.id)===e.id?"active":""),onClick:()=>(e=>{u(e);const s=j.filter(s=>s.chat_id===e.id);v(s)})(e),children:[(0,d.jsx)("div",{className:"chat-icon",children:E(e)}),(0,d.jsxs)("div",{className:"chat-info",children:[(0,d.jsx)("div",{className:"chat-name",children:D(e)}),(0,d.jsx)("div",{className:"chat-meta",children:"group"===e.type?"".concat(e.member_count," th\xe0nh vi\xean"):"Tin nh\u1eafn ri\xeang"}),(0,d.jsx)("div",{className:"chat-last-activity",children:L(e.last_activity)})]})]},e.id))})]}),(0,d.jsx)("div",{className:"messages-area",children:x?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"messages-header",children:[(0,d.jsxs)("div",{className:"chat-title",children:[(0,d.jsx)("span",{className:"chat-icon",children:E(x)}),(0,d.jsx)("span",{children:D(x)})]}),(0,d.jsx)("div",{className:"message-actions",children:(0,d.jsx)("button",{className:"btn btn-primary",onClick:()=>C(!0),children:"\u2709\ufe0f G\u1eedi tin nh\u1eafn"})})]}),(0,d.jsx)("div",{className:"messages-list",children:j.map(e=>(0,d.jsx)("div",{className:"message-item ".concat("bot"===e.from?"bot-message":"user-message"),children:(0,d.jsxs)("div",{className:"message-content",children:[(0,d.jsx)("div",{className:"message-text",children:e.text}),(0,d.jsx)("div",{className:"message-time",children:L(e.date)})]})},e.id))})]}):(0,d.jsxs)("div",{className:"no-chat-selected",children:[(0,d.jsx)("div",{className:"empty-icon",children:"\ud83d\udcac"}),(0,d.jsx)("h3",{children:"Ch\u1ecdn m\u1ed9t chat \u0111\u1ec3 xem tin nh\u1eafn"}),(0,d.jsx)("p",{children:"Ch\u1ecdn t\u1eeb danh s\xe1ch b\xean tr\xe1i \u0111\u1ec3 b\u1eaft \u0111\u1ea7u tr\xf2 chuy\u1ec7n"})]})})]})]}),k&&(0,d.jsx)("div",{className:"modal-overlay",children:(0,d.jsxs)("div",{className:"modal",children:[(0,d.jsxs)("div",{className:"modal-header",children:[(0,d.jsx)("h3",{children:"G\u1eedi tin nh\u1eafn"}),(0,d.jsx)("button",{className:"close-btn",onClick:()=>C(!1),children:"\u2715"})]}),(0,d.jsxs)("div",{className:"modal-body",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{children:"Lo\u1ea1i tin nh\u1eafn"}),(0,d.jsxs)("select",{value:N,onChange:e=>_(e.target.value),className:"select-field",children:[(0,d.jsx)("option",{value:"text",children:"V\u0103n b\u1ea3n"}),(0,d.jsx)("option",{value:"photo",children:"H\xecnh \u1ea3nh"}),(0,d.jsx)("option",{value:"document",children:"T\xe0i li\u1ec7u"})]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{children:"N\u1ed9i dung tin nh\u1eafn"}),(0,d.jsx)("textarea",{value:p,onChange:e=>b(e.target.value),placeholder:"Nh\u1eadp n\u1ed9i dung tin nh\u1eafn...",className:"textarea-field",rows:"4"})]})]}),(0,d.jsxs)("div",{className:"modal-footer",children:[(0,d.jsx)("button",{className:"btn btn-secondary",onClick:()=>C(!1),children:"H\u1ee7y"}),(0,d.jsx)("button",{className:"btn btn-primary",onClick:async()=>{if(!p.trim()||!x)return;const e={id:Date.now(),chat_id:x.id,text:p,date:(new Date).toISOString(),from:"user",message_type:N};v(s=>[e,...s]),b(""),C(!1);try{if((await r.sendMessage(p,x.id,"HTML")).success){l.Ay.success("Tin nh\u1eafn \u0111\xe3 \u0111\u01b0\u1ee3c g\u1eedi th\xe0nh c\xf4ng!");const e={id:Date.now()+1,chat_id:x.id,text:"\u2705 Tin nh\u1eafn \u0111\xe3 \u0111\u01b0\u1ee3c g\u1eedi th\xe0nh c\xf4ng!",date:(new Date).toISOString(),from:"bot",message_type:"text"};v(s=>[e,...s])}}catch(s){console.error("Error sending message:",s),l.Ay.error("L\u1ed7i g\u1eedi tin nh\u1eafn: ".concat(s.message));const t={id:Date.now()+1,chat_id:x.id,text:"\u274c L\u1ed7i: ".concat(s.message),date:(new Date).toISOString(),from:"bot",message_type:"error"};v(e=>[t,...e])}},disabled:!p.trim(),children:"G\u1eedi tin nh\u1eafn"}),(0,d.jsx)("button",{className:"btn btn-warning",onClick:()=>{if(!p.trim())return;const e=m.map(e=>({id:Date.now()+Math.random(),chat_id:e.id,text:p,date:(new Date).toISOString(),from:"user",message_type:N}));v(s=>[...e,...s]),b(""),C(!1)},disabled:!p.trim(),children:"G\u1eedi t\u1ea5t c\u1ea3"})]})]})})]})}}}]);
//# sourceMappingURL=telegram.b43aea2a.chunk.js.map
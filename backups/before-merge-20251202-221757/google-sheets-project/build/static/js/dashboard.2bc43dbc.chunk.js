"use strict";(self.webpackChunkreact_google_sheets_project=self.webpackChunkreact_google_sheets_project||[]).push([[945],{34728:(e,t,s)=>{s.r(t),s.d(t,{default:()=>C});var c=s(89379),n=s(65043),o=s(53151),i=s(27986),r=s(6319),l=s(24217),a=s(93509),d=s(84211),h=s(35799),u=s(68663),m=s(31144),f=s(73053),k=s(33029),b=s(99195),x=s(63025);const p=import.meta.env.VITE_API_URL||import.meta.env.REACT_APP_API_URL||"http://localhost:3001";const v=new class{constructor(){this.socket=null,this.connected=!1,this.listeners=new Map,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3}connect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.socket&&this.connected)return console.log("\u26a0\ufe0f Already connected to WebSocket"),this.socket;try{return this.socket=(0,x.io)(p,{transports:["websocket","polling"],reconnection:!0,reconnectionAttempts:this.maxReconnectAttempts,reconnectionDelay:this.reconnectDelay,autoConnect:!0,withCredentials:!0}),this.socket.on("connect",()=>{console.log("\u2705 Connected to WebSocket server:",this.socket.id),this.connected=!0,this.reconnectAttempts=0,e&&this.socket.emit("join-room",{room:"user:".concat(e),userId:e}),this.emit("connected",{socketId:this.socket.id})}),this.socket.on("disconnect",e=>{console.log("\u274c Disconnected from WebSocket:",e),this.connected=!1,this.emit("disconnected",{reason:e})}),this.socket.on("connect_error",e=>{console.error("\u274c WebSocket connection error:",e),this.reconnectAttempts++,this.emit("connection-error",{error:e,attempt:this.reconnectAttempts})}),this.socket.on("reconnect",e=>{console.log("\ud83d\udd04 Reconnected after ".concat(e," attempts")),this.emit("reconnected",{attemptNumber:e})}),this.socket.on("pong",e=>{this.emit("pong",e)}),this.socket}catch(t){return console.error("\u274c Failed to connect to WebSocket:",t),this.emit("connection-error",{error:t}),null}}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null,this.connected=!1,this.listeners.clear(),console.log("\ud83d\udd0c Disconnected from WebSocket"))}isConnected(){return this.connected&&this.socket&&this.socket.connected}joinRoom(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.isConnected()?this.socket.emit("join-room",{room:e,userId:t}):console.error("\u26a0\ufe0f Cannot join room: not connected")}leaveRoom(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.isConnected()?this.socket.emit("leave-room",{room:e,userId:t}):console.error("\u26a0\ufe0f Cannot leave room: not connected")}subscribeMetrics(){this.isConnected()||this.connect(),this.socket.emit("subscribe-metrics")}unsubscribeMetrics(){this.isConnected()&&this.socket.emit("unsubscribe-metrics")}subscribeNotifications(e){this.isConnected()||this.connect(e),this.socket.emit("subscribe-notifications",{userId:e}),this.joinRoom("notifications:".concat(e),e)}unsubscribeNotifications(e){this.isConnected()&&(this.socket.emit("unsubscribe-notifications",{userId:e}),this.leaveRoom("notifications:".concat(e),e))}joinSheetsRoom(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s="sheets:".concat(e);this.joinRoom(s,t)}leaveSheetsRoom(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s="sheets:".concat(e);this.leaveRoom(s,t)}sendSheetsEdit(e,t,s){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.isConnected()?this.socket.emit("sheets-edit",{spreadsheetId:e,range:t,value:s,userId:c}):console.error("\u26a0\ufe0f Cannot send sheets edit: not connected")}sendCursorPosition(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.isConnected()&&this.socket.emit("sheets-cursor",{spreadsheetId:e,cell:t,userId:s})}on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t),this.socket&&this.socket.on(e,t)}off(e,t){const s=this.listeners.get(e);if(s){const e=s.indexOf(t);e>-1&&s.splice(e,1)}this.socket&&this.socket.off(e,t)}emit(e,t){const s=this.listeners.get(e);s&&s.forEach(s=>{try{s(t)}catch(c){console.error("Error in listener for ".concat(e,":"),c)}})}getSocketId(){return this.socket?this.socket.id:null}},j=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const[s,c]=(0,n.useState)(!1),[o,i]=(0,n.useState)(null),[r,l]=(0,n.useState)(null),a=(0,n.useRef)([]);(0,n.useEffect)(()=>{if(t){v.connect(e);const t=e=>{let{socketId:t}=e;c(!0),i(t),l(null)},s=()=>{c(!1),i(null)},n=e=>{let{error:t}=e;l(t),c(!1)};return v.on("connected",t),v.on("disconnected",s),v.on("connection-error",n),a.current=[{event:"connected",callback:t},{event:"disconnected",callback:s},{event:"connection-error",callback:n}],()=>{a.current.forEach(e=>{let{event:t,callback:s}=e;v.off(t,s)})}}},[e,t]),(0,n.useEffect)(()=>()=>{t||v.disconnect()},[t]);return{connected:s,socketId:o,error:r,subscribe:(0,n.useCallback)((e,t)=>(v.on(e,t),a.current.push({event:e,callback:t}),()=>{v.off(e,t);const s=a.current.findIndex(s=>s.event===e&&s.callback===t);s>-1&&a.current.splice(s,1)}),[]),unsubscribe:(0,n.useCallback)((e,t)=>{v.off(e,t)},[]),websocket:v,connect:()=>v.connect(e),disconnect:()=>v.disconnect(),isConnected:()=>v.isConnected()}};var g=s(70579);const{Title:y,Text:A}=o.A,C=()=>{const{connected:e,subscribe:t,unsubscribe:s}=j(null,!0),[o,x]=(0,n.useState)({cpu:0,memory:0,activeUsers:0,timestamp:null}),[p,C]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{if(!e)return;v.subscribeMetrics();const s=t("metrics-update",e=>{x(t=>(0,c.A)((0,c.A)({},t),e)),C(!1)}),n=t("connected",()=>{C(!1)});return()=>{s(),n(),v.unsubscribeMetrics()}},[e,t]),(0,g.jsxs)("div",{className:"live-dashboard",children:[(0,g.jsxs)("div",{className:"dashboard-header",children:[(0,g.jsxs)(y,{level:2,children:[(0,g.jsx)(m.A,{})," Live Dashboard"]}),(0,g.jsxs)(i.A,{children:[(0,g.jsx)(r.A,{color:e?"green":"red",children:e?"\ud83d\udfe2 Connected":"\ud83d\udd34 Disconnected"}),(0,g.jsx)(A,{type:"secondary",children:"Real-time metrics updates"})]})]}),p&&!e?(0,g.jsxs)("div",{className:"loading-container",children:[(0,g.jsx)(l.A,{size:"large"}),(0,g.jsx)(A,{children:"Connecting to WebSocket server..."})]}):(0,g.jsxs)(a.A,{gutter:[16,16],children:[(0,g.jsx)(d.A,{xs:24,sm:12,md:6,children:(0,g.jsxs)(h.A,{children:[(0,g.jsx)(u.A,{title:"CPU Usage",value:o.cpu,precision:1,suffix:"%",prefix:(0,g.jsx)(f.A,{}),valueStyle:{color:o.cpu>80?"#cf1322":o.cpu>50?"#faad14":"#3f8600"}}),(0,g.jsx)("div",{className:"metric-bar",children:(0,g.jsx)("div",{className:"metric-bar-fill",style:{width:"".concat(o.cpu,"%"),backgroundColor:o.cpu>80?"#cf1322":o.cpu>50?"#faad14":"#3f8600"}})})]})}),(0,g.jsx)(d.A,{xs:24,sm:12,md:6,children:(0,g.jsxs)(h.A,{children:[(0,g.jsx)(u.A,{title:"Memory Usage",value:o.memory,precision:1,suffix:"%",prefix:(0,g.jsx)(k.A,{}),valueStyle:{color:o.memory>80?"#cf1322":o.memory>50?"#faad14":"#3f8600"}}),(0,g.jsx)("div",{className:"metric-bar",children:(0,g.jsx)("div",{className:"metric-bar-fill",style:{width:"".concat(o.memory,"%"),backgroundColor:o.memory>80?"#cf1322":o.memory>50?"#faad14":"#3f8600"}})})]})}),(0,g.jsx)(d.A,{xs:24,sm:12,md:6,children:(0,g.jsxs)(h.A,{children:[(0,g.jsx)(u.A,{title:"Active Users",value:o.activeUsers||0,prefix:(0,g.jsx)(b.A,{}),valueStyle:{color:"#1890ff"}}),(0,g.jsx)(A,{type:"secondary",style:{fontSize:12},children:"WebSocket connections"})]})}),(0,g.jsx)(d.A,{xs:24,sm:12,md:6,children:(0,g.jsxs)(h.A,{children:[(0,g.jsx)(u.A,{title:"Status",value:e?"Online":"Offline",prefix:e?"\ud83d\udfe2":"\ud83d\udd34",valueStyle:{color:e?"#3f8600":"#cf1322"}}),o.timestamp&&(0,g.jsxs)(A,{type:"secondary",style:{fontSize:12},children:["Last update:"," ",new Date(o.timestamp).toLocaleTimeString("vi-VN")]})]})})]}),(0,g.jsxs)(a.A,{gutter:[16,16],style:{marginTop:24},children:[(0,g.jsx)(d.A,{xs:24,md:12,children:(0,g.jsx)(h.A,{title:"CPU Usage History",children:(0,g.jsx)("div",{className:"metrics-history",children:(0,g.jsxs)(A,{type:"secondary",children:["Real-time CPU usage tracking",(0,g.jsx)("br",{}),"Updates every 5 seconds via WebSocket"]})})})}),(0,g.jsx)(d.A,{xs:24,md:12,children:(0,g.jsx)(h.A,{title:"Memory Usage History",children:(0,g.jsx)("div",{className:"metrics-history",children:(0,g.jsxs)(A,{type:"secondary",children:["Real-time memory usage tracking",(0,g.jsx)("br",{}),"Updates every 5 seconds via WebSocket"]})})})})]})]})}}}]);
//# sourceMappingURL=dashboard.2bc43dbc.chunk.js.map
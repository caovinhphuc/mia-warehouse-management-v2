"use strict";(self.webpackChunkreact_google_sheets_project=self.webpackChunkreact_google_sheets_project||[]).push([[599],{55153:(e,t,s)=>{s.r(t),s.d(t,{default:()=>h});var a=s(89379),n=s(65043),o=s(5137),r=s(58021),l=s(79722);const i=import.meta.env.VITE_API_BASE_URL||"http://localhost:3001/api";const c=new class{async readSheet(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"A1:Z1000",t=arguments.length>1?arguments[1]:void 0;try{const s={range:e};t&&(s.sheetId=t);const a=await l.A.get("".concat(i,"/sheets/read"),{params:s});return{data:a.data.data,range:a.data.range,majorDimension:a.data.majorDimension}}catch(n){var s,a;throw console.error("Error reading sheet:",n),new Error((null===(s=n.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.error)||"Failed to read sheet: ".concat(n.message))}}async writeSheet(e,t,s){try{return(await l.A.post("".concat(i,"/sheets/write"),{range:e,values:t,sheetId:s})).data.data}catch(o){var a,n;throw console.error("Error writing to sheet:",o),new Error((null===(a=o.response)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.error)||"Failed to write to sheet: ".concat(o.message))}}async appendToSheet(e,t,s){try{return(await l.A.post("".concat(i,"/sheets/append"),{range:e,values:t,sheetId:s})).data.data}catch(o){var a,n;throw console.error("Error appending to sheet:",o),new Error((null===(a=o.response)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.error)||"Failed to append to sheet: ".concat(o.message))}}async getSheetMetadata(e){try{const t=e?"".concat(i,"/sheets/metadata/").concat(e):"".concat(i,"/sheets/metadata");return(await l.A.get(t)).data.data}catch(a){var t,s;throw console.error("Error getting sheet metadata:",a),new Error((null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.error)||"Failed to get sheet metadata: ".concat(a.message))}}async clearSheet(e,t){try{return(await l.A.delete("".concat(i,"/sheets/clear"),{data:{range:e,sheetId:t}})).data.data}catch(n){var s,a;throw console.error("Error clearing sheet:",n),new Error((null===(s=n.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.error)||"Failed to clear sheet: ".concat(n.message))}}async addSheet(e,t){try{return(await l.A.post("".concat(i,"/sheets/add-sheet"),{sheetName:e,sheetId:t})).data.data}catch(n){var s,a;throw console.error("Error adding sheet:",n),new Error((null===(s=n.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.error)||"Failed to add sheet: ".concat(n.message))}}};var d=s(70579);const h=()=>{const{loading:e,error:t}=(0,o.d4)(e=>e.sheets),{isAuthenticated:s,serviceAccount:l}=(0,o.d4)(e=>e.auth),[i,h]=(0,n.useState)(null),[m,u]=(0,n.useState)([]),[v,x]=(0,n.useState)(!1),[p,g]=(0,n.useState)({}),[j,b]=(0,n.useState)(""),[N,w]=(0,n.useState)([]),[y,S]=(0,n.useState)(!1),[E,C]=(0,n.useState)(""),[f,k]=(0,n.useState)(!1),[_,A]=(0,n.useState)(""),[T,I]=(0,n.useState)([]),[L,D]=(0,n.useState)([]),[P,G]=(0,n.useState)(!1),[B,H]=(0,n.useState)(!1),[O,F]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{G(!0),F(null);try{const e=await c.getSheetMetadata(),t={id:import.meta.env.VITE_GOOGLE_SHEETS_SPREADSHEET_ID||"18B1PIhCDmBWyHZytvOcfj_1QbYBwczLf1x1Qbu0E5As",title:e.title,sheets:e.sheets.map((e,t)=>{var s,a;return{name:e.title,id:e.sheetId,rowCount:(null===(s=e.gridProperties)||void 0===s?void 0:s.rowCount)||0,columnCount:(null===(a=e.gridProperties)||void 0===a?void 0:a.columnCount)||0}})};D([t])}catch(e){console.error("Failed to load sheet metadata:",e),F(e.message),D([])}finally{G(!1)}})()},[]),(0,n.useEffect)(()=>{(async()=>{if(i){H(!0);try{const e=i.name,t="".concat(e,"!A1:Z1000"),s=await c.readSheet(t);u(s.data||[])}catch(e){console.error("Failed to load sheet content:",e),u([])}finally{H(!1)}}else u([])})()},[i]),(0,n.useEffect)(()=>{if(j){const e=m.filter(e=>e.some(e=>e.toString().toLowerCase().includes(j.toLowerCase())));w(e)}else w(m)},[j,m]);const R=(e,t)=>{var s;t||(t=(null===(s=L[0])||void 0===s?void 0:s.id)||import.meta.env.VITE_GOOGLE_SHEETS_SPREADSHEET_ID||"18B1PIhCDmBWyHZytvOcfj_1QbYBwczLf1x1Qbu0E5As");const a="https://docs.google.com/spreadsheets/d/".concat(t,"/edit#gid=").concat(e.id);window.open(a,"_blank")};return e?(0,d.jsx)(r.A,{text:"\u0110ang t\u1ea3i Google Sheets...",fullScreen:!0}):t?(0,d.jsxs)("div",{className:"sheets-error",children:[(0,d.jsx)("h3",{children:"L\u1ed7i k\u1ebft n\u1ed1i Google Sheets"}),(0,d.jsx)("p",{children:t}),(0,d.jsx)("button",{onClick:()=>window.location.reload(),children:"Th\u1eed l\u1ea1i"})]}):(0,d.jsxs)("div",{className:"google-sheets-integration dashboard-container",children:[(0,d.jsxs)("div",{className:"sheets-header page-header",children:[(0,d.jsx)("div",{className:"header-title-group",children:(0,d.jsx)("h2",{children:"\ud83d\udcca Google Sheets Integration"})}),(0,d.jsxs)("div",{className:"sheets-controls page-controls",children:[(0,d.jsx)("button",{className:"btn btn-primary",onClick:()=>S(!0),children:"\u2795 T\u1ea1o sheet m\u1edbi"}),i&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{className:"btn btn-secondary",onClick:()=>x(!v),children:v?"\ud83d\udcbe L\u01b0u":"\u270f\ufe0f Ch\u1ec9nh s\u1eeda"}),(0,d.jsx)("button",{className:"btn btn-primary",onClick:()=>{const e=N.map(e=>e.join(",")).join("\n"),t=new Blob([e],{type:"text/csv"}),s=window.URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download="".concat((null===i||void 0===i?void 0:i.name)||"sheet",".csv"),a.click(),window.URL.revokeObjectURL(s)},children:"\ud83d\udce5 Xu\u1ea5t CSV"})]})]})]}),(0,d.jsxs)("div",{className:"sheets-content two-column-layout",children:[(0,d.jsxs)("div",{className:"sheets-sidebar",children:[(0,d.jsxs)("div",{className:"sidebar-header",children:[(0,d.jsx)("h3",{children:"\ud83d\udccb Danh s\xe1ch Sheets"}),P?(0,d.jsx)("span",{className:"sheets-count",children:"\u0110ang t\u1ea3i..."}):(0,d.jsxs)("span",{className:"sheets-count",children:[L.reduce((e,t)=>e+t.sheets.length,0)," ","sheets"]})]}),O&&(0,d.jsxs)("div",{className:"error-banner",style:{padding:"10px",margin:"10px",backgroundColor:"#ffebee",color:"#c62828",borderRadius:"4px"},children:["\u26a0\ufe0f L\u1ed7i t\u1ea3i metadata: ",O]}),(0,d.jsx)("div",{className:"sheets-list",children:P?(0,d.jsx)("div",{style:{padding:"20px",textAlign:"center"},children:"\u0110ang t\u1ea3i..."}):0===L.length?(0,d.jsx)("div",{style:{padding:"20px",textAlign:"center"},children:"Kh\xf4ng c\xf3 sheets n\xe0o"}):L.map(e=>(0,d.jsxs)("div",{className:"spreadsheet-group",children:[(0,d.jsx)("div",{className:"spreadsheet-title",children:e.title}),e.sheets.map(t=>(0,d.jsxs)("div",{className:"sheet-item ".concat((null===i||void 0===i?void 0:i.id)===t.id?"active":""),onClick:()=>(e=>{h(e),x(!1),g({})})(t),onDoubleClick:()=>R(t,e.id),title:"Double-click \u0111\u1ec3 m\u1edf tr\xean Google Sheets",children:[(0,d.jsxs)("div",{className:"sheet-info",children:[(0,d.jsxs)("div",{className:"sheet-header-item",children:[(0,d.jsx)("span",{className:"sheet-name",children:t.name}),(0,d.jsxs)("div",{className:"sheet-status-container",children:[(0,d.jsx)("span",{className:"sheet-status",children:"\ud83d\udcca"}),(null===i||void 0===i?void 0:i.id)===t.id&&(0,d.jsx)("span",{className:"sheet-active-tag",children:"\u0110ang ho\u1ea1t \u0111\u1ed9ng"})]})]}),(0,d.jsxs)("div",{className:"sheet-description",children:["Google Sheets - ",t.rowCount," h\xe0ng \xd7"," ",t.columnCount," c\u1ed9t"]}),(0,d.jsxs)("div",{className:"sheet-meta",children:[(0,d.jsx)("span",{className:"sheet-trigger",children:"\ud83d\udcca sheets"}),(0,d.jsx)("span",{className:"sheet-action",children:"\ud83d\udcc5 sync"})]}),(0,d.jsxs)("div",{className:"sheet-stats",children:[(0,d.jsxs)("span",{children:[t.rowCount," b\u1ea3n ghi"]}),(0,d.jsx)("span",{children:"100% ho\xe0n th\xe0nh"})]})]}),(0,d.jsxs)("div",{className:"sheet-actions",children:[(0,d.jsx)("button",{className:"action-btn",onClick:s=>{s.stopPropagation(),R(t,e.id)},title:"M\u1edf tr\xean Google Sheets",children:"\ud83d\udd17"}),(0,d.jsx)("button",{className:"action-btn",onClick:e=>{e.stopPropagation(),alert("Th\xeam c\u1ed9t v\xe0o "+t.name)},title:"Th\xeam c\u1ed9t",children:"\u2795"}),(0,d.jsx)("button",{className:"action-btn",onClick:e=>{e.stopPropagation(),alert("Th\xeam h\xe0ng v\xe0o "+t.name)},title:"Th\xeam h\xe0ng",children:"\ud83d\udcdd"}),(0,d.jsx)("button",{className:"action-btn",onClick:e=>{e.stopPropagation(),alert("X\xf3a d\xf2ng tr\u1ed1ng trong "+t.name)},title:"X\xf3a d\xf2ng tr\u1ed1ng",children:"\ud83d\uddd1\ufe0f"}),(0,d.jsx)("button",{className:"action-btn",onClick:e=>{e.stopPropagation(),alert("ID: ".concat(t.id||(null===i||void 0===i?void 0:i.id)))},title:"Xem ID",children:"\ud83d\udc41\ufe0f"})]})]},t.id))]},e.id))})]}),(0,d.jsx)("div",{className:"sheets-main-content",children:B?(0,d.jsx)("div",{style:{padding:"40px",textAlign:"center"},children:(0,d.jsx)(r.A,{text:"\u0110ang t\u1ea3i d\u1eef li\u1ec7u sheet..."})}):i?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"sheet-header",children:[(0,d.jsxs)("div",{className:"sheet-info-section",children:[(0,d.jsxs)("div",{className:"sheet-title-info",children:[(0,d.jsx)("h3",{children:i.name}),(0,d.jsxs)("span",{className:"sheet-dimensions",children:[i.rowCount," h\xe0ng \xd7"," ",i.columnCount," c\u1ed9t"]})]}),(0,d.jsx)("button",{className:"btn btn-link",onClick:()=>{var e;const t=(null===(e=L[0])||void 0===e?void 0:e.id)||import.meta.env.VITE_GOOGLE_SHEETS_SPREADSHEET_ID||"18B1PIhCDmBWyHZytvOcfj_1QbYBwczLf1x1Qbu0E5As";R(i,t)},title:"M\u1edf tr\xean Google Sheets",style:{marginLeft:"10px",padding:"4px 8px"},children:"\ud83d\udd17 M\u1edf tr\xean Google Sheets"})]}),(0,d.jsxs)("div",{className:"sheet-actions",children:[(0,d.jsx)("input",{type:"text",placeholder:"\ud83d\udd0d T\xecm ki\u1ebfm...",value:j,onChange:e=>b(e.target.value),className:"search-input"}),(0,d.jsxs)("span",{className:"row-count",children:[N.length," rows"]})]})]}),(0,d.jsx)("div",{className:"sheet-table-container",children:0===N.length?(0,d.jsx)("div",{style:{padding:"40px",textAlign:"center"},children:(0,d.jsx)("p",{children:"Sheet tr\u1ed1ng ho\u1eb7c kh\xf4ng c\xf3 d\u1eef li\u1ec7u"})}):(0,d.jsxs)("table",{className:"sheet-table",children:[(0,d.jsx)("thead",{children:(0,d.jsx)("tr",{children:N[0].map((e,t)=>(0,d.jsx)("th",{children:e},t))})}),(0,d.jsx)("tbody",{children:N.slice(1).map((e,t)=>(0,d.jsx)("tr",{children:e.map((e,s)=>(0,d.jsx)("td",{children:v?(0,d.jsx)("input",{type:"text",value:p["".concat(t+1,"-").concat(s)]||e,onChange:e=>((e,t,s)=>{g((0,a.A)((0,a.A)({},p),{},{["".concat(e,"-").concat(t)]:s}))})(t+1,s,e.target.value),className:"cell-input"}):(0,d.jsx)("span",{className:"cell-content",children:e})},s))},t))})]})})]}):(0,d.jsxs)("div",{className:"no-sheet-selected",children:[(0,d.jsx)("div",{className:"no-sheet-icon",children:"\ud83d\udcca"}),(0,d.jsx)("h3",{children:"Ch\u1ecdn m\u1ed9t sheet \u0111\u1ec3 xem d\u1eef li\u1ec7u"}),(0,d.jsx)("p",{children:"Nh\u1ea5p v\xe0o m\u1ed9t sheet trong danh s\xe1ch b\xean tr\xe1i \u0111\u1ec3 b\u1eaft \u0111\u1ea7u"})]})})]}),y&&(0,d.jsx)("div",{className:"modal-overlay",children:(0,d.jsxs)("div",{className:"modal",children:[(0,d.jsxs)("div",{className:"modal-header",children:[(0,d.jsx)("h3",{children:"T\u1ea1o sheet m\u1edbi"}),(0,d.jsx)("button",{className:"close-btn",onClick:()=>S(!1),children:"\u2715"})]}),(0,d.jsx)("div",{className:"modal-body",children:(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{children:"T\xean sheet"}),(0,d.jsx)("input",{type:"text",value:E,onChange:e=>C(e.target.value),placeholder:"Nh\u1eadp t\xean sheet...",className:"input-field"})]})}),(0,d.jsxs)("div",{className:"modal-footer",children:[(0,d.jsx)("button",{className:"btn btn-secondary",onClick:()=>S(!1),children:"H\u1ee7y"}),(0,d.jsx)("button",{className:"btn btn-primary",onClick:async()=>{if(E.trim())try{var e;G(!0);const t=(null===(e=L[0])||void 0===e?void 0:e.id)||import.meta.env.VITE_GOOGLE_SHEETS_SPREADSHEET_ID||"18B1PIhCDmBWyHZytvOcfj_1QbYBwczLf1x1Qbu0E5As",s=await c.addSheet(E.trim(),t),a=await c.getSheetMetadata(t),n={id:t,title:a.title,sheets:a.sheets.map((e,t)=>{var s,a;return{name:e.title,id:e.sheetId,rowCount:(null===(s=e.gridProperties)||void 0===s?void 0:s.rowCount)||0,columnCount:(null===(a=e.gridProperties)||void 0===a?void 0:a.columnCount)||0}})};D([n]);const o=n.sheets.find(e=>e.id===s.sheetId);o&&h(o),C(""),S(!1),G(!1)}catch(t){console.error("Error creating sheet:",t),alert("L\u1ed7i t\u1ea1o sheet: ".concat(t.message)),G(!1)}},disabled:!E.trim(),children:"T\u1ea1o sheet"})]})]})}),f&&(0,d.jsx)("div",{className:"modal-overlay",children:(0,d.jsxs)("div",{className:"modal",children:[(0,d.jsxs)("div",{className:"modal-header",children:[(0,d.jsx)("h3",{children:"Th\xeam c\u1ed9t m\u1edbi"}),(0,d.jsx)("button",{className:"close-btn",onClick:()=>k(!1),children:"\u2715"})]}),(0,d.jsx)("div",{className:"modal-body",children:(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{children:"T\xean c\u1ed9t"}),(0,d.jsx)("input",{type:"text",value:_,onChange:e=>A(e.target.value),placeholder:"Nh\u1eadp t\xean c\u1ed9t...",className:"input-field"})]})}),(0,d.jsxs)("div",{className:"modal-footer",children:[(0,d.jsx)("button",{className:"btn btn-secondary",onClick:()=>k(!1),children:"H\u1ee7y"}),(0,d.jsx)("button",{className:"btn btn-primary",onClick:()=>{if(!_.trim()||!i)return;const e=m.map((e,t)=>0===t?[...e,_]:[...e,""]);u(e),A(""),k(!1)},disabled:!_.trim(),children:"Th\xeam c\u1ed9t"})]})]})})]})}}}]);
//# sourceMappingURL=google-sheets.5aca2691.chunk.js.map
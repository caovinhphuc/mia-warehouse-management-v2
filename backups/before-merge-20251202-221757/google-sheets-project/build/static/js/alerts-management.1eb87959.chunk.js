/*! For license information please see alerts-management.1eb87959.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkreact_google_sheets_project=self.webpackChunkreact_google_sheets_project||[]).push([[566],{44136:(e,t,s)=>{s.r(t),s.d(t,{default:()=>H});var n=s(89379),a=s(65043),r=s(53151),l=s(93292),i=s(9690),c=s(85289),o=s(68508),h=s(6319),d=s(58543),u=s(88971),m=s(35799),g=s(27986),p=s(27340),j=s(93509),x=s(84211),A=s(68663),y=s(97432),f=s(52069),v=s(74173),w=s(95552),b=s(98233);const T={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M816 768h-24V428c0-141.1-104.3-257.7-240-277.1V112c0-22.1-17.9-40-40-40s-40 17.9-40 40v38.9c-135.7 19.4-240 136-240 277.1v340h-24c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h216c0 61.8 50.2 112 112 112s112-50.2 112-112h216c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM512 888c-26.5 0-48-21.5-48-48h96c0 26.5-21.5 48-48 48zM304 768V428c0-55.6 21.6-107.8 60.9-147.1S456.4 220 512 220c55.6 0 107.8 21.6 147.1 60.9S720 372.4 720 428v340H304z"}}]},name:"bell",theme:"outlined"};var k=s(9146);function C(){return C=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},C.apply(this,arguments)}const I=(e,t)=>b.createElement(k.A,C({},e,{ref:t,icon:T}));const S=b.forwardRef(I);var O=s(97042),E=s(57148),L=s(57861),M=s(91917),_=s(70579);const{Title:z}=r.A,{TextArea:P}=l.A,{Option:N}=i.A,V=import.meta.env.VITE_API_URL||import.meta.env.REACT_APP_API_URL||"http://localhost:3001",H=()=>{const[e,t]=(0,a.useState)([]),[s,r]=(0,a.useState)(!1),[b,T]=(0,a.useState)(!1),[k,C]=(0,a.useState)(null),[I]=c.A.useForm(),[H,R]=(0,a.useState)({total:0,sent:0,failed:0,pending:0});(0,a.useEffect)(()=>{D(),F()},[]);const D=async()=>{try{r(!0);const e=await fetch("".concat(V,"/api/alerts/history")),s=await e.json();s.success&&t((s.data||[]).map(e=>(0,n.A)((0,n.A)({},e),{},{key:e.id})))}catch(e){console.error("Error fetching alerts:",e),o.Ay.error("Kh\xf4ng th\u1ec3 t\u1ea3i danh s\xe1ch alerts")}finally{r(!1)}},F=async()=>{try{const e=await fetch("".concat(V,"/api/alerts/statistics")),t=await e.json();t.success&&R(t.data||H)}catch(e){console.error("Error fetching statistics:",e)}},q=[{title:"Th\u1eddi gian",dataIndex:"timestamp",key:"timestamp",render:e=>new Date(e).toLocaleString("vi-VN"),sorter:(e,t)=>new Date(e.timestamp)-new Date(t.timestamp),width:180},{title:"Lo\u1ea1i",dataIndex:"type",key:"type",render:e=>(0,_.jsx)(h.A,{color:{email:"blue",telegram:"cyan",both:"purple"}[e]||"default",children:e}),width:100},{title:"Tr\u1ea1ng th\xe1i",dataIndex:"status",key:"status",render:e=>{const t={sent:{color:"success",icon:(0,_.jsx)(v.A,{})},success:{color:"success",icon:(0,_.jsx)(v.A,{})},failed:{color:"error",icon:(0,_.jsx)(w.A,{})},pending:{color:"warning",icon:(0,_.jsx)(S,{})}},s=t[e]||t.pending;return(0,_.jsx)(h.A,{color:s.color,icon:s.icon,children:e})},width:120},{title:"N\u1ed9i dung",dataIndex:"message",key:"message",ellipsis:!0,render:e=>{if(!e)return"-";if(e.match(/<[^>]+>/)){return e.replace(/<[^>]+>/g,"").trim()||e.substring(0,50)}return e.length>50?e.substring(0,50)+"...":e}},{title:"H\xe0nh \u0111\u1ed9ng",key:"action",width:100,render:(e,t)=>(0,_.jsx)(d.A,{title:"X\xf3a alert n\xe0y?",onConfirm:()=>(async()=>{o.Ay.info("Delete functionality depends on backend implementation")})(t.id),okText:"X\xf3a",cancelText:"H\u1ee7y",children:(0,_.jsx)(u.Ay,{type:"link",danger:!0,icon:(0,_.jsx)(O.A,{}),size:"small"})})}];return(0,_.jsxs)("div",{style:{padding:16},children:[(0,_.jsxs)(m.A,{children:[(0,_.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,_.jsxs)(z,{level:2,style:{margin:0},children:[(0,_.jsx)(S,{})," Qu\u1ea3n L\xfd Alerts"]}),(0,_.jsxs)(g.A,{children:[(0,_.jsx)(p.A,{title:"Refresh",children:(0,_.jsx)(u.Ay,{icon:(0,_.jsx)(E.A,{}),onClick:()=>{D(),F()}})}),(0,_.jsx)(u.Ay,{icon:(0,_.jsx)(L.A,{}),onClick:()=>async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";try{const t=await fetch("".concat(V,"/api/alerts/test"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({channel:e})}),s=await t.json();if(!s.success)throw new Error(s.error||"Test failed");o.Ay.success("Test alert th\xe0nh c\xf4ng!"),await F(),await D()}catch(t){console.error("Error testing alert:",t),o.Ay.error("L\u1ed7i test alert: ".concat(t.message))}}("all"),children:"Test Alerts"}),(0,_.jsx)(u.Ay,{type:"primary",icon:(0,_.jsx)(M.A,{}),onClick:()=>{C(null),T(!0)},children:"T\u1ea1o Alert M\u1edbi"})]})]}),(0,_.jsxs)(j.A,{gutter:16,children:[(0,_.jsx)(x.A,{xs:12,sm:6,children:(0,_.jsx)(A.A,{title:"T\u1ed5ng s\u1ed1",value:H.total,prefix:(0,_.jsx)(S,{})})}),(0,_.jsx)(x.A,{xs:12,sm:6,children:(0,_.jsx)(A.A,{title:"\u0110\xe3 g\u1eedi",value:H.sent,valueStyle:{color:"#3f8600"},prefix:(0,_.jsx)(v.A,{})})}),(0,_.jsx)(x.A,{xs:12,sm:6,children:(0,_.jsx)(A.A,{title:"Th\u1ea5t b\u1ea1i",value:H.failed,valueStyle:{color:"#cf1322"},prefix:(0,_.jsx)(w.A,{})})}),(0,_.jsx)(x.A,{xs:12,sm:6,children:(0,_.jsx)(A.A,{title:"\u0110ang ch\u1edd",value:H.pending,valueStyle:{color:"#faad14"},prefix:(0,_.jsx)(S,{})})})]})]}),(0,_.jsx)(m.A,{title:(0,_.jsxs)(g.A,{children:[(0,_.jsx)("span",{children:"Danh s\xe1ch Alerts"}),(0,_.jsx)(h.A,{children:e.length})]}),style:{marginTop:16},children:(0,_.jsx)(y.A,{columns:q,dataSource:e,loading:s,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0},size:"middle"})}),(0,_.jsx)(f.A,{title:k?"Ch\u1ec9nh s\u1eeda Alert":"T\u1ea1o Alert M\u1edbi",open:b,onCancel:()=>{T(!1),I.resetFields(),C(null)},footer:null,width:600,children:(0,_.jsxs)(c.A,{form:I,layout:"vertical",onFinish:async e=>{try{var t,s;const n=await fetch("".concat(V,"/api/alerts/send"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:null!==(t=e.channels)&&void 0!==t&&t.includes("email")?{to:e.emailTo,subject:e.subject,text:e.message,html:e.htmlMessage||e.message}:null,telegram:null!==(s=e.channels)&&void 0!==s&&s.includes("telegram")?{chatId:e.telegramChatId||void 0,message:e.message,parseMode:"HTML"}:null,channels:e.channels||["email"]})}),a=await n.json();if(!a.success)throw new Error(a.error||"Failed to send alert");o.Ay.success("Alert \u0111\xe3 \u0111\u01b0\u1ee3c g\u1eedi th\xe0nh c\xf4ng!"),T(!1),I.resetFields(),await D(),await F()}catch(n){console.error("Error creating alert:",n),o.Ay.error("L\u1ed7i g\u1eedi alert: ".concat(n.message))}},initialValues:{channels:["email"]},children:[(0,_.jsx)(c.A.Item,{name:"channels",label:"K\xeanh g\u1eedi",rules:[{required:!0,message:"Ch\u1ecdn \xedt nh\u1ea5t m\u1ed9t k\xeanh!"}],children:(0,_.jsxs)(i.A,{mode:"multiple",placeholder:"Ch\u1ecdn k\xeanh g\u1eedi",children:[(0,_.jsx)(N,{value:"email",children:"Email"}),(0,_.jsx)(N,{value:"telegram",children:"Telegram"})]})}),(0,_.jsx)(c.A.Item,{name:"emailTo",label:"Email ng\u01b0\u1eddi nh\u1eadn",rules:[{type:"email",message:"Email kh\xf4ng h\u1ee3p l\u1ec7!"}],children:(0,_.jsx)(l.A,{placeholder:"email@example.com"})}),(0,_.jsx)(c.A.Item,{name:"telegramChatId",label:"Telegram Chat ID (t\xf9y ch\u1ecdn)",children:(0,_.jsx)(l.A,{placeholder:"-123456789"})}),(0,_.jsx)(c.A.Item,{name:"subject",label:"Ti\xeau \u0111\u1ec1",rules:[{required:!0,message:"Vui l\xf2ng nh\u1eadp ti\xeau \u0111\u1ec1!"}],children:(0,_.jsx)(l.A,{placeholder:"Ti\xeau \u0111\u1ec1 alert"})}),(0,_.jsx)(c.A.Item,{name:"message",label:"N\u1ed9i dung",rules:[{required:!0,message:"Vui l\xf2ng nh\u1eadp n\u1ed9i dung!"}],children:(0,_.jsx)(P,{rows:4,placeholder:"N\u1ed9i dung alert"})}),(0,_.jsx)(c.A.Item,{name:"htmlMessage",label:"N\u1ed9i dung HTML (t\xf9y ch\u1ecdn)",children:(0,_.jsx)(P,{rows:4,placeholder:"<p>N\u1ed9i dung HTML</p>"})}),(0,_.jsx)(c.A.Item,{children:(0,_.jsxs)(g.A,{children:[(0,_.jsx)(u.Ay,{type:"primary",htmlType:"submit",children:k?"C\u1eadp nh\u1eadt Alert":"T\u1ea1o Alert"}),(0,_.jsx)(u.Ay,{onClick:()=>{T(!1),I.resetFields(),C(null)},children:"H\u1ee7y"})]})})]})})]})}},57861:(e,t,s)=>{s.d(t,{A:()=>c});var n=s(98233);const a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M931.4 498.9L94.9 79.5c-3.4-1.7-7.3-2.1-11-1.2a15.99 15.99 0 00-11.7 19.3l86.2 352.2c1.3 5.3 5.2 9.6 10.4 11.3l147.7 50.7-147.6 50.7c-5.2 1.8-9.1 6-10.3 11.3L72.2 926.5c-.9 3.7-.5 7.6 1.2 10.9 3.9 7.9 13.5 11.1 21.5 7.2l836.5-417c3.1-1.5 5.6-4.1 7.2-7.1 3.9-8 .7-17.6-7.2-21.6zM170.8 826.3l50.3-205.6 295.2-101.3c2.3-.8 4.2-2.6 5-5 1.4-4.2-.8-8.7-5-10.2L221.1 403 171 198.2l628 314.9-628.2 313.2z"}}]},name:"send",theme:"outlined"};var r=s(9146);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},l.apply(this,arguments)}const i=(e,t)=>n.createElement(r.A,l({},e,{ref:t,icon:a}));const c=n.forwardRef(i)},91917:(e,t,s)=>{s.d(t,{A:()=>c});var n=s(98233),a=s(23470),r=s(9146);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},l.apply(this,arguments)}const i=(e,t)=>n.createElement(r.A,l({},e,{ref:t,icon:a.A}));const c=n.forwardRef(i)}}]);
//# sourceMappingURL=alerts-management.1eb87959.chunk.js.map
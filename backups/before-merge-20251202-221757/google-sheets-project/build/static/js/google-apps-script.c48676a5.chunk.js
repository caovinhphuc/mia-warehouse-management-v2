"use strict";(self.webpackChunkreact_google_sheets_project=self.webpackChunkreact_google_sheets_project||[]).push([[661],{87715:(e,t,s)=>{s.r(t),s.d(t,{default:()=>h});var c=s(89379),a=s(65043),n=s(5137),i=s(58021);const r=import.meta.env.VITE_API_URL||import.meta.env.REACT_APP_API_URL||"http://localhost:3001";const o=new class{async executeScript(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"main",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];try{const c=await fetch("".concat(r,"/api/script/execute"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scriptId:e,functionName:t,parameters:s})});if(!c.ok){const e=await c.json().catch(()=>({}));throw new Error(e.error||"Script execution failed: ".concat(c.statusText))}return await c.json()}catch(c){throw console.error("Error executing script:",c),c}}async executeInline(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"main",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];try{const c=await fetch("".concat(r,"/api/script/execute-inline"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,functionName:t,parameters:s})});if(!c.ok){const e=await c.json().catch(()=>({}));throw new Error(e.error||"Inline script execution failed: ".concat(c.statusText))}return await c.json()}catch(c){throw console.error("Error executing inline script:",c),c}}async getScriptStatus(e){try{const t=await fetch("".concat(r,"/api/script/status/").concat(e));if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.error||"Failed to get script status: ".concat(t.statusText))}return await t.json()}catch(t){throw console.error("Error getting script status:",t),t}}async listProjects(){try{const e=await fetch("".concat(r,"/api/script/projects"));if(!e.ok){const t=await e.json().catch(()=>({}));throw new Error(t.error||"Failed to list projects: ".concat(e.statusText))}return await e.json()}catch(e){throw console.error("Error listing projects:",e),e}}async testScript(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"main",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];try{const c=await fetch("".concat(r,"/api/script/test"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scriptId:e,functionName:t,parameters:s})});if(!c.ok){const e=await c.json().catch(()=>({}));throw new Error(e.error||"Script test failed: ".concat(c.statusText))}return await c.json()}catch(c){throw console.error("Error testing script:",c),c}}};var l=s(68508),d=s(70579);const h=()=>{const{loading:e,error:t}=(0,n.d4)(e=>e.auth),{isAuthenticated:s,serviceAccount:r}=(0,n.d4)(e=>e.auth),[h,p]=(0,a.useState)([]),[u,g]=(0,a.useState)(null),[m,x]=(0,a.useState)(""),[j,v]=(0,a.useState)(!1),[S,N]=(0,a.useState)([]),[f,y]=(0,a.useState)(!1),[w,b]=(0,a.useState)(""),[T,k]=(0,a.useState)(""),A=[{id:"script_1",name:"T\u1ef1 \u0111\u1ed9ng g\u1eedi email b\xe1o c\xe1o",description:"G\u1eedi email b\xe1o c\xe1o h\xe0ng ng\xe0y cho qu\u1ea3n l\xfd",lastModified:"2024-01-15T10:30:00Z",status:"active",executions:45,code:"function sendDailyReport() {\n  const sheet = SpreadsheetApp.getActiveSheet();\n  const data = sheet.getDataRange().getValues();\n\n  // T\u1ea1o b\xe1o c\xe1o\n  let report = \"B\xe1o c\xe1o h\xe0ng ng\xe0y:\\n\\n\";\n  report += \"T\u1ed5ng s\u1ed1 \u0111\u01a1n h\xe0ng: \" + data.length + \"\\n\";\n  report += \"Ng\xe0y: \" + new Date().toLocaleDateString('vi-VN');\n\n  // G\u1eedi email\n  MailApp.sendEmail({\n    to: 'manager@mia.vn',\n    subject: 'B\xe1o c\xe1o h\xe0ng ng\xe0y - ' + new Date().toLocaleDateString('vi-VN'),\n    body: report\n  });\n\n  console.log('Email \u0111\xe3 \u0111\u01b0\u1ee3c g\u1eedi th\xe0nh c\xf4ng');\n}"},{id:"script_2",name:"\u0110\u1ed3ng b\u1ed9 d\u1eef li\u1ec7u Google Sheets",description:"\u0110\u1ed3ng b\u1ed9 d\u1eef li\u1ec7u gi\u1eefa c\xe1c sheet kh\xe1c nhau",lastModified:"2024-01-14T15:45:00Z",status:"active",executions:23,code:"function syncSheetsData() {\n  const sourceSheet = SpreadsheetApp.openById('SOURCE_SHEET_ID').getActiveSheet();\n  const targetSheet = SpreadsheetApp.openById('TARGET_SHEET_ID').getActiveSheet();\n\n  const data = sourceSheet.getDataRange().getValues();\n  targetSheet.getRange(1, 1, data.length, data[0].length).setValues(data);\n\n  console.log('D\u1eef li\u1ec7u \u0111\xe3 \u0111\u01b0\u1ee3c \u0111\u1ed3ng b\u1ed9 th\xe0nh c\xf4ng');\n}"},{id:"script_3",name:"T\u1ef1 \u0111\u1ed9ng backup d\u1eef li\u1ec7u",description:"T\u1ea1o backup d\u1eef li\u1ec7u h\xe0ng tu\u1ea7n",lastModified:"2024-01-13T09:20:00Z",status:"inactive",executions:8,code:"function weeklyBackup() {\n  const sheet = SpreadsheetApp.getActiveSheet();\n  const data = sheet.getDataRange().getValues();\n\n  // T\u1ea1o file backup\n  const backupSheet = SpreadsheetApp.create('Backup_' + new Date().getTime());\n  backupSheet.getActiveSheet().getRange(1, 1, data.length, data[0].length).setValues(data);\n\n  console.log('Backup \u0111\xe3 \u0111\u01b0\u1ee3c t\u1ea1o th\xe0nh c\xf4ng');\n}"}];(0,a.useEffect)(()=>{p(A)},[]);const D=e=>{switch(e){case"success":return"#22c55e";case"error":return"#ef4444";case"warning":return"#f59e0b";default:return"#3b82f6"}};return e?(0,d.jsx)(i.A,{}):t?(0,d.jsxs)("div",{className:"error-state",children:["L\u1ed7i: ",t]}):(0,d.jsxs)("div",{className:"apps-script-container",children:[(0,d.jsxs)("div",{className:"script-header",children:[(0,d.jsxs)("div",{className:"header-left",children:[(0,d.jsx)("h1",{children:"\u2699\ufe0f Google Apps Script"}),(0,d.jsx)("p",{children:"T\u1ef1 \u0111\u1ed9ng h\xf3a c\xf4ng vi\u1ec7c v\u1edbi Google Apps Script"})]}),(0,d.jsx)("div",{className:"header-right",children:(0,d.jsx)("button",{className:"btn btn-primary",onClick:()=>y(!0),children:"\u2795 T\u1ea1o script m\u1edbi"})})]}),(0,d.jsxs)("div",{className:"script-content",children:[(0,d.jsxs)("div",{className:"scripts-sidebar",children:[(0,d.jsxs)("div",{className:"sidebar-header",children:[(0,d.jsx)("h3",{children:"\ud83d\udcdc Danh s\xe1ch Scripts"}),(0,d.jsxs)("span",{className:"script-count",children:[h.length," scripts"]})]}),(0,d.jsx)("div",{className:"scripts-list",children:h.map(e=>{return(0,d.jsxs)("div",{className:"script-item ".concat((null===u||void 0===u?void 0:u.id)===e.id?"active":""),onClick:()=>(e=>{g(e),x(e.code)})(e),children:[(0,d.jsxs)("div",{className:"script-info",children:[(0,d.jsx)("div",{className:"script-name",children:e.name}),(0,d.jsx)("div",{className:"script-description",children:e.description}),(0,d.jsxs)("div",{className:"script-meta",children:[(0,d.jsx)("span",{className:"script-status",style:{color:(t=e.status,"active"===t?"#22c55e":"#ef4444")},children:"active"===e.status?"\ud83d\udfe2 Ho\u1ea1t \u0111\u1ed9ng":"\ud83d\udd34 T\u1ea1m d\u1eebng"}),(0,d.jsxs)("span",{className:"script-executions",children:[e.executions," l\u1ea7n ch\u1ea1y"]})]})]}),(0,d.jsx)("div",{className:"script-actions",children:(0,d.jsx)("button",{className:"action-btn",onClick:t=>{var s;t.stopPropagation(),s=e.id,p(e=>e.filter(e=>e.id!==s)),(null===u||void 0===u?void 0:u.id)===s&&(g(null),x(""))},title:"X\xf3a script",children:"\ud83d\uddd1\ufe0f"})})]},e.id);var t})})]}),(0,d.jsx)("div",{className:"script-editor",children:u?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"editor-header",children:[(0,d.jsxs)("div",{className:"script-title",children:[(0,d.jsx)("h3",{children:u.name}),(0,d.jsxs)("span",{className:"script-id",children:["ID: ",u.id]})]}),(0,d.jsxs)("div",{className:"editor-actions",children:[(0,d.jsx)("button",{className:"btn btn-secondary",onClick:()=>{u&&(p(e=>e.map(e=>e.id===u.id?(0,c.A)((0,c.A)({},e),{},{code:m,lastModified:(new Date).toISOString()}):e)),g(e=>(0,c.A)((0,c.A)({},e),{},{code:m,lastModified:(new Date).toISOString()})))},children:"\ud83d\udcbe L\u01b0u"}),(0,d.jsx)("button",{className:"btn btn-primary",onClick:async()=>{if(u){v(!0),N([]);try{let e;if(N([{time:(new Date).toISOString(),message:"B\u1eaft \u0111\u1ea7u th\u1ef1c thi script...",type:"info"}]),e=u.scriptId?await o.executeScript(u.scriptId,u.functionName||"main",u.parameters||[]):await o.executeInline(u.code,u.functionName||"main",u.parameters||[]),!e.success)throw new Error(e.error||"Script execution failed");N(t=>[...t,{time:(new Date).toISOString(),message:"\u2705 Script \u0111\xe3 \u0111\u01b0\u1ee3c th\u1ef1c thi th\xe0nh c\xf4ng!",type:"success"},{time:(new Date).toISOString(),message:"K\u1ebft qu\u1ea3: ".concat(JSON.stringify(e.data)),type:"info"}]),l.Ay.success("Script \u0111\xe3 \u0111\u01b0\u1ee3c th\u1ef1c thi th\xe0nh c\xf4ng!")}catch(t){console.error("Error executing script:",t),N(s=>[...s,{time:(new Date).toISOString(),message:"\u274c L\u1ed7i: ".concat(t.message),type:"error"}]),l.Ay.error("L\u1ed7i th\u1ef1c thi script: ".concat(t.message))}finally{v(!1)}}},disabled:j,children:j?"\u23f3 \u0110ang ch\u1ea1y...":"\u25b6\ufe0f Ch\u1ea1y script"})]})]}),(0,d.jsx)("div",{className:"code-editor",children:(0,d.jsx)("textarea",{value:m,onChange:e=>x(e.target.value),placeholder:"Vi\u1ebft code JavaScript c\u1ee7a b\u1ea1n \u1edf \u0111\xe2y...",className:"code-textarea"})}),S.length>0&&(0,d.jsxs)("div",{className:"execution-logs",children:[(0,d.jsx)("h4",{children:"\ud83d\udccb Nh\u1eadt k\xfd th\u1ef1c thi"}),(0,d.jsx)("div",{className:"logs-container",children:S.map((e,t)=>(0,d.jsxs)("div",{className:"log-entry",children:[(0,d.jsx)("span",{className:"log-time",children:new Date(e.time).toLocaleTimeString("vi-VN")}),(0,d.jsx)("span",{className:"log-message",style:{color:D(e.type)},children:e.message})]},t))})]})]}):(0,d.jsxs)("div",{className:"no-script-selected",children:[(0,d.jsx)("div",{className:"empty-icon",children:"\u2699\ufe0f"}),(0,d.jsx)("h3",{children:"Ch\u1ecdn m\u1ed9t script \u0111\u1ec3 ch\u1ec9nh s\u1eeda"}),(0,d.jsx)("p",{children:"T\u1ea1o script m\u1edbi ho\u1eb7c ch\u1ecdn t\u1eeb danh s\xe1ch b\xean tr\xe1i"})]})})]}),f&&(0,d.jsx)("div",{className:"modal-overlay",children:(0,d.jsxs)("div",{className:"modal",children:[(0,d.jsxs)("div",{className:"modal-header",children:[(0,d.jsx)("h3",{children:"T\u1ea1o script m\u1edbi"}),(0,d.jsx)("button",{className:"close-btn",onClick:()=>y(!1),children:"\u2715"})]}),(0,d.jsxs)("div",{className:"modal-body",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{children:"T\xean script"}),(0,d.jsx)("input",{type:"text",value:w,onChange:e=>b(e.target.value),placeholder:"Nh\u1eadp t\xean script...",className:"input-field"})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{children:"M\xf4 t\u1ea3"}),(0,d.jsx)("textarea",{value:T,onChange:e=>k(e.target.value),placeholder:"M\xf4 t\u1ea3 ch\u1ee9c n\u0103ng c\u1ee7a script...",className:"textarea-field",rows:"3"})]})]}),(0,d.jsxs)("div",{className:"modal-footer",children:[(0,d.jsx)("button",{className:"btn btn-secondary",onClick:()=>y(!1),children:"H\u1ee7y"}),(0,d.jsx)("button",{className:"btn btn-primary",onClick:()=>{if(!w.trim())return;const e={id:"script_".concat(Date.now()),name:w,description:T,lastModified:(new Date).toISOString(),status:"active",executions:0,code:"function ".concat(w.replace(/\s+/g,""),"() {\n  // Vi\u1ebft code c\u1ee7a b\u1ea1n \u1edf \u0111\xe2y\n  console.log('Script m\u1edbi \u0111\xe3 \u0111\u01b0\u1ee3c t\u1ea1o');\n}")};p(t=>[e,...t]),b(""),k(""),y(!1)},disabled:!w.trim(),children:"T\u1ea1o script"})]})]})})]})}}}]);
//# sourceMappingURL=google-apps-script.c48676a5.chunk.js.map